<%- include('../partials/header') %>


    <div class="text-center">
        <h1>Meal Details for <%= (meal.date.getMonth() + 1) + '/' + (meal.date.getDate() + 1) + '/' +
                meal.date.getFullYear() %>
        </h1>
        <table class="table table-striped table-bordered">
            <tr>
                <th>Breakfast:</th>
                <td>
                    <%= meal.breakfast %>
                </td>
                <td>
                    <%= meal.breakfastCals %> Calories
                </td>
            </tr>
            <tr>
                <th>Lunch:</th>
                <td>
                    <%= meal.lunch %>
                </td>
                <td>
                    <%= meal.lunchCals %> Calories
                </td>
            </tr>
            <tr>
                <th>Dinner:</th>
                <td>
                    <%= meal.dinner %>
                </td>
                <td>
                    <%= meal.dinnerCals %> Calories
                </td>
            </tr>
            <tr>
                <th>Snack(s):</th>
                <td>
                    <%= meal.snacks %>
                </td>
                <td>
                    <%= meal.snackCals %> Calories
                </td>
            </tr>
        </table>
        <a href="/meals/<%= meal._id %>/edit"><button class="btn btn-success">Add/Edit Meals</button></a><br><br>
    </div>



    <% let totalCalories=meal.breakfastCals + meal.lunchCals + meal.dinnerCals + meal.snackCals %>



        <div class="card chart-container">
            <canvas id="chart1"></canvas>
            <div class="text-center">
                <p>
                    <%= totalCalories %> Calories
                </p>
            </div>
        </div><br><br>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>



        <script>
            const ctx1 = document.getElementById("chart1").getContext('2d');
            const myChart1 = new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: ["Breakfast Calories", "Lunch Calories", "Dinner Calories", "Snack Calories"],
                    datasets: [{
                        label: 'Food Items',
                        backgroundColor: ["#0074D9", "#FF4136", "#2ECC40", "#FF851B"],
                        data: [<%= meal.breakfastCals %>,<%= meal.lunchCals %>,<%= meal.dinnerCals %>,<%= meal.snackCals %>],
                    }]
                },
            });
        </script>

        <div class="text-center">
            <form action="/meals/<%= meal._id %>/notes" method="POST">
                <textarea name="content" placeholder="Notes" cols="45" rows="3" w></textarea><br>
                <input type="submit" class="btn btn-primary" value="Add Note">
            </form><br><br>


            <% if (meal.notes.length) { %>
                <table class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Notes</th>
                            <th>Delete?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% meal.notes.forEach(function(n) { %>
                            <tr>
                                <td>
                                    <%= n.createdAt.toDateString() %>
                                </td>
                                <td>
                                    <%= n.content %>
                                </td>
                                <td>
                                    <form action="/notes/<%= n._id %>?_method=DELETE" method="POST">
                                        <button type="submit" class="btn btn-danger">X</button>
                                    </form>
                                </td>
                            </tr>
                            <% }); %>
                    </tbody>
                </table>
                <% } else { %>
                    <h5>No Notes Yet</h5>
                    <% } %>
        </div>


        <%- include('../partials/footer') %>